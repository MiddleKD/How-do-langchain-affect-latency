# How Do LangChain Affect Latency?

Langchainê³¼ Celeryê°€ ì„±ëŠ¥ì— ì£¼ëŠ” ì˜í–¥ ë¹„êµ í…ŒìŠ¤íŠ¸

## ê³µí†µ ì„¤ì •

* **LLM Backend**: Ollama (llama3.1 / RTX 4090)
* **API ì„œë²„**: FastAPI
* **Task Queue (í•´ë‹¹ ì‹œ)**: Celery + Redis
* **Ramp-up ì¡°ê±´**:

  * **300ëª… í…ŒìŠ¤íŠ¸**: 3ë¶„ê°„ ì´ˆë‹¹ 5ëª… ì¦ê°€
  * **1000ëª… í…ŒìŠ¤íŠ¸**: 3ë¶„ê°„ ì´ˆë‹¹ 10ëª… ì¦ê°€

---

## í…ŒìŠ¤íŠ¸ ê²°ê³¼ (300ëª… / 1000ëª… ë™ì ‘)

| Case                 | ë™ì ‘   | Type        | Name                        | Requests | Fails | Median (ms) | 95%ile (ms) | 99%ile (ms) | Average (ms) | Min (ms) | Max (ms) | Avg size (bytes) | Current RPS | Failures/s |
| -------------------- | ---- | ----------- | --------------------------- | -------- | ----- | ----------- | ----------- | ----------- | ------------ | -------- | -------- | ---------------- | ----------- | ---------- |
| Pure Python          | 300  | POST        | /generate                   | 4608     | 0     | 9600        | 11000       | 11000       | 8021.21      | 219      | 11597    | 145.36           | 27.3        | 0          |
| Pure Python          | 1000 | POST        | /generate                   | 4603     | 0     | 24000       | 38000       | 38000       | 22912.62     | 331      | 39332    | 147.26           | 25.8        | 0          |
| Langchain            | 300  | POST        | /generate                   | 4633     | 0     | 9500        | 11000       | 11000       | 7969.42      | 175      | 11557    | 144.6            | 25.8        | 0          |
| Langchain            | 1000 | POST        | /generate                   | 3683     | 0     | 22000       | 58000       | 59000       | 27062.88     | 213      | 59776    | 145.36           | 12.3        | 0          |
| Pure Python + Celery | 300  | POST+GET(s) | /generate + /result polling | 4589     | 0     | 9600        | 11000       | 11000       | 8041.02      | 308      | 11947    | 0                | 25.0        | 0          |
| Pure Python + Celery | 1000 | POST+GET(s) | /generate + /result polling | 4627     | 0     | 25000       | 37000       | 37000       | 22920.69     | 310      | 38575    | 0                | 26.2        | 0          |
| Langchain + Celery   | 300  | POST+GET(s) | /generate + /result polling | 4513     | 0     | 9700        | 11000       | 11000       | 8194.09      | 207      | 11777    | 0                | 26.3        | 0          |
| Langchain + Celery   | 1000 | POST+GET(s) | /generate + /result polling | 4568     | 0     | 24000       | 38000       | 39000       | 23275.62     | 308      | 39615    | 0                | 27.6        | 0          |

---

# âœ… ì„±ëŠ¥ ë¹„êµ ë¶„ì„ ìš”ì•½

## ğŸ“Š 1. Pure Python vs LangChain

| ë™ì ‘   | ì§€í‘œ      | Pure Python | LangChain | ì°¨ì´                            |
| ---- | ------- | ----------- | --------- | ----------------------------- |
| 300  | í‰ê·  ì‘ë‹µì‹œê°„ | 8021 ms     | 7969 ms   | â‰ˆ ë™ì¼                          |
| 1000 | í‰ê·  ì‘ë‹µì‹œê°„ | 22912 ms    | 27062 ms  | **LangChainì´ ëŠë¦¼ (+18%)** |

âœ… **í•´ì„**

300ëª… ì‹œì ì—ì„œëŠ” LangChain ë„ì…ì´ í° ì°¨ì´ ì—†ìŒ.
1000ëª… ì‹œì ì—ì„œëŠ” LangChain ì‚¬ìš© ì‹œ ì˜¤ë²„í—¤ë“œ ë°œìƒ (ì•½ 18% ëŠë¦¼).
**LangChain ë‚´ë¶€ì˜ ë¶ˆí•„ìš”í•œ ëŒ€ê¸° ì‹œê°„ ì¡´ì¬ ê°€ëŠ¥ì„±**

---

## ğŸ“Š 2. Celery ë„ì… íš¨ê³¼ (Pure Python ê¸°ì¤€)

| ë™ì ‘   | ì§€í‘œ      | Non-Celery | Celery   | ì°¨ì´   |
| ---- | ------- | ---------- | -------- | ---- |
| 300  | í‰ê·  ì‘ë‹µì‹œê°„ | 8021 ms    | 8041 ms  | â‰ˆ ë™ì¼ |
| 1000 | í‰ê·  ì‘ë‹µì‹œê°„ | 22912 ms   | 22920 ms | â‰ˆ ë™ì¼ |

âœ… **í•´ì„**

Celery ì ìš© ì—¬ë¶€ê°€ ëŒ€ê¸°ì—´ ì§€ì—°ì„ ë³„ë¡œ ì¤„ì´ì§€ ëª»í•¨.
ì‹±ê¸€ ë…¸ë“œ / ë‹¨ì¼ ì›Œì»¤ì¸ ê²½ìš° ì´ì  ì—†ìŒ.
(ì—¬ëŸ¬ Worker ë¶„ì‚° ì²˜ë¦¬ì‹œ ê°œì„ ë  ì—¬ì§€ ìˆìŒ)

---

## ğŸ“Š 3. LangChain + Celery ì¡°í•© íš¨ê³¼

| ë™ì ‘   | ì§€í‘œ      | LangChain Only | LangChain + Celery | ì°¨ì´                         |
| ---- | ------- | -------------- | ------------------ | -------------------------- |
| 300  | í‰ê·  ì‘ë‹µì‹œê°„ | 7969 ms        | 8194 ms            | ì•½ê°„ ëŠë¦¼ (+2\~3%)             |
| 1000 | í‰ê·  ì‘ë‹µì‹œê°„ | 27062 ms       | 23275 ms           | **Celery ë²„ì „ì´ ë” ë¹ ë¦„ (-14%)** |

âœ… **í•´ì„**

LangChain + Celery ì¡°í•©ì´ 1000ëª… ì‹œì ì—ì„œëŠ” ì˜¤íˆë ¤ ì„±ëŠ¥ ê°œì„  íš¨ê³¼ ë³´ì„. 300ëª…ì€ ì˜¤ì°¨ ë²”ìœ„ ë‚´ë¼ê³  ìƒê°.
**LangChain ë‚´ë¶€ì˜ ë¶ˆí•„ìš”í•œ ëŒ€ê¸° ì‹œê°„ ì¡´ì¬ ê°€ëŠ¥ì„±**

---

## âœ… ìµœì¢… ì¢…í•© ìš”ì•½

| ë™ì ‘   | ìµœì € í‰ê·  ì‘ë‹µì‹œê°„ ì¼€ì´ìŠ¤                 |
| ---- | ------------------------------ |
| 300  | Pure Python / LangChain ê±°ì˜ ë™ì¼  |
| 1000 | **LangChain + Celery** ê°€ ê°€ì¥ ë¹ ë¦„ |

âœ… **ê²°ë¡ **

* **ì†Œê·œëª¨ íŠ¸ë˜í”½:** ë‹¨ìˆœ Python, LangChain, Celery ì—¬ë¶€ ê´€ê³„ ì—†ìŒ
* **ëŒ€ê·œëª¨ íŠ¸ë˜í”½:** Langchain ì‚¬ìš© ìì œ. ë¹„ë™ê¸°í + ë‹¨ìˆœ íŒŒì´ì¬ êµ¬í˜„ì´ ìœ ë¦¬ => ì§€í‘œìƒ Langchain + celeryê°€ ê°€ì¥ ì¢‹ì§€ë§Œ, [ğŸ“Š 1. Pure Python vs LangChain](#-1-pure-python-vs-langchain) ë¥¼ ë¬´ì‹œí•  ìˆ˜ ì—†ìŒ
---
